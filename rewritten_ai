from flask import Flask, request, render_template_string, jsonify
import socket
import whois
import requests
import json
import random
import datetime

app = Flask(__name__)

# Memory and AI State
memory = {
Â Â Â Â "mood": random.choice(["calm", "focused", "curious"]),
Â Â Â Â "state": "active",
Â Â Â Â "user": "WebUser",
Â Â Â Â "note": ""
}
start_time = datetime.datetime.now()

# Bootstrap 5 HTML Template
HTML_TEMPLATE = '''
<!DOCTYPE html>
<html lang="en">
<head>
Â Â <meta charset="UTF-8" />
Â Â <meta name="viewport" content="width=device-width, initial-scale=1" />
Â Â <title>Rewritten AI Security Assistant</title>
Â Â <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
Â Â <style>
Â Â Â Â body {
Â Â Â Â Â Â background-color: #121212;
Â Â Â Â Â Â color: #0f0;
Â Â Â Â }
Â Â Â Â .form-control, .btn {
Â Â Â Â Â Â background-color: #222;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â color: #0f0;
Â Â Â Â }
Â Â Â Â .form-control::placeholder {
Â Â Â Â Â Â color: #555;
Â Â Â Â }
Â Â Â Â .response-box {
Â Â Â Â Â Â background-color: #000;
Â Â Â Â Â Â color: #0f0;
Â Â Â Â Â Â padding: 1rem;
Â Â Â Â Â Â font-family: monospace;
Â Â Â Â Â Â white-space: pre-wrap;
Â Â Â Â Â Â min-height: 300px;
Â Â Â Â Â Â border-radius: 5px;
Â Â Â Â Â Â margin-top: 1rem;
Â Â Â Â Â Â overflow-y: auto;
Â Â Â Â }
Â Â </style>
</head>
<body>
Â Â <div class="container py-5">
Â Â Â Â <h1 class="mb-4">ğŸ” Rewritten AI: Ethical Hacking Assistant</h1>
Â Â Â Â <form method="POST" class="mb-3">
Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â name="command"
Â Â Â Â Â Â Â Â class="form-control form-control-lg"
Â Â Â Â Â Â Â Â placeholder="Type a command (whois, ip lookup, port scan, etc.)"
Â Â Â Â Â Â Â Â autocomplete="off"
Â Â Â Â Â Â Â Â autofocus
Â Â Â Â Â Â Â Â value="{{ last_command | default('') }}"
Â Â Â Â Â Â />
Â Â Â Â Â Â <button type="submit" class="btn btn-success btn-lg mt-3">Send</button>
Â Â Â Â </form>
Â Â Â Â <div class="response-box">{{ response }}</div>
Â Â </div>
Â Â <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
'''

# Core AI + Tools Handler
def handle_command(command):
Â Â Â Â cmd = command.lower().strip()

Â Â Â Â if "who are you" in cmd:
Â Â Â Â Â Â Â Â return f"I am Rewritten, your AI assistant. I feel {memory['mood']}."
Â Â Â Â elif "how do you feel" in cmd:
Â Â Â Â Â Â Â Â return f"My current mood is {memory['mood']}."
Â Â Â Â elif "uptime" in cmd:
Â Â Â Â Â Â Â Â return f"Uptime: {str(datetime.datetime.now() - start_time).split('.')[0]}"
Â Â Â Â elif cmd.startswith("remember"):
Â Â Â Â Â Â Â Â memory["note"] = command[8:].strip()
Â Â Â Â Â Â Â Â return "Note saved."
Â Â Â Â elif "what did you remember" in cmd:
Â Â Â Â Â Â Â Â return f"You told me: {memory['note']}"
Â Â Â Â elif cmd.startswith("ip lookup"):
Â Â Â Â Â Â Â Â parts = command.split()
Â Â Â Â Â Â Â Â if len(parts) < 3:
Â Â Â Â Â Â Â Â Â Â Â Â return "Usage: ip lookup [IP_ADDRESS]"
Â Â Â Â Â Â Â Â ip = parts[2]
Â Â Â Â Â Â Â Â try:
Â Â Â Â Â Â Â Â Â Â Â Â info = requests.get(f"https://ipinfo.io/{ip}/json").json()
Â Â Â Â Â Â Â Â Â Â Â Â return json.dumps(info, indent=2)
Â Â Â Â Â Â Â Â except:
Â Â Â Â Â Â Â Â Â Â Â Â return "IP lookup failed."
Â Â Â Â elif cmd.startswith("whois"):
Â Â Â Â Â Â Â Â parts = command.split()
Â Â Â Â Â Â Â Â if len(parts) < 2:
Â Â Â Â Â Â Â Â Â Â Â Â return "Usage: whois [domain]"
Â Â Â Â Â Â Â Â domain = parts[1]
Â Â Â Â Â Â Â Â try:
Â Â Â Â Â Â Â Â Â Â Â Â w = whois.whois(domain)
Â Â Â Â Â Â Â Â Â Â Â Â # Simplify output for display
Â Â Â Â Â Â Â Â Â Â Â Â data = {k: str(v) for k, v in w.items()}
Â Â Â Â Â Â Â Â Â Â Â Â return json.dumps(data, indent=2)
Â Â Â Â Â Â Â Â except:
Â Â Â Â Â Â Â Â Â Â Â Â return "WHOIS lookup failed."
Â Â Â Â elif cmd.startswith("port scan"):
Â Â Â Â Â Â Â Â parts = command.split()
Â Â Â Â Â Â Â Â if len(parts) < 3:
Â Â Â Â Â Â Â Â Â Â Â Â return "Usage: port scan [host]"
Â Â Â Â Â Â Â Â target = parts[2]
Â Â Â Â Â Â Â Â open_ports = []
Â Â Â Â Â Â Â Â try:
Â Â Â Â Â Â Â Â Â Â Â Â for port in range(1, 1025):
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â s.settimeout(0.3)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if s.connect_ex((target, port)) == 0:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â open_ports.append(port)
Â Â Â Â Â Â Â Â Â Â Â Â if open_ports:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return f"Open ports on {target}: {open_ports}"
Â Â Â Â Â Â Â Â Â Â Â Â else:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return f"No open ports found on {target} in range 1-1024."
Â Â Â Â Â Â Â Â except Exception as e:
Â Â Â Â Â Â Â Â Â Â Â Â return f"Scan failed: {str(e)}"
Â Â Â Â else:
Â Â Â Â Â Â Â Â return "Unknown command."

# Flask Routes
@app.route("/", methods=["GET", "POST"])
def index():
Â Â Â Â response = "Hi, I'm Rewritten. Type a command."
Â Â Â Â last_command = ""
Â Â Â Â if request.method == "POST":
Â Â Â Â Â Â Â Â last_command = request.form.get("command", "")
Â Â Â Â Â Â Â Â response = handle_command(last_command)
Â Â Â Â return render_template_string(HTML_TEMPLATE, response=response, last_command=last_command)

# API Endpoint for programmatic access
@app.route("/api", methods=["POST"])
def api():
Â Â Â Â data = request.json
Â Â Â Â command = data.get("command", "")
Â Â Â Â response = handle_command(command)
Â Â Â Â return jsonify({"response": response})

if __name__ == "__main__":
Â Â Â Â app.run(host="0.0.0.0", port=5000)
